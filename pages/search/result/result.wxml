<!-- pages/search/result/result.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢å® ç‰©ã€å•†å®¶ã€æœåŠ¡æˆ–å•†å“" 
        value="{{keyword}}" 
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <text class="clear-btn" wx:if="{{keyword}}" bindtap="clearSearch">Ã—</text>
    </view>
    <button class="search-btn" bindtap="onSearch">æœç´¢</button>
  </view>

  <!-- æœç´¢å»ºè®®åˆ—è¡¨ -->
  <view class="suggestions-list" wx:if="{{showSuggestions && suggestions.length > 0}}">
    <view class="suggestion-item" wx:for="{{suggestions}}" wx:key="*this" bindtap="onSuggestionTap" data-keyword="{{item}}">
      <text class="suggestion-icon">ğŸ”</text>
      <text class="suggestion-text">{{item}}</text>
    </view>
  </view>

  <!-- æœç´¢ç»“æœç»Ÿè®¡ -->
  <view class="result-stats" wx:if="{{!isLoading}}">
    <text>å…±æ‰¾åˆ° {{totalResults}} æ¡ç»“æœ</text>
  </view>

  <!-- ç»“æœç±»å‹åˆ‡æ¢ -->
  <scroll-view scroll-x="true" class="result-type-tabs" enable-flex="true">
    <view class="tab-item {{activeType === 'all' ? 'active' : ''}}" bindtap="switchResultType" data-type="all">å…¨éƒ¨</view>
    <view class="tab-item {{activeType === 'pet' ? 'active' : ''}}" bindtap="switchResultType" data-type="pet">å® ç‰©</view>
    <view class="tab-item {{activeType === 'product' ? 'active' : ''}}" bindtap="switchResultType" data-type="product">å•†å“</view>
    <view class="tab-item {{activeType === 'service' ? 'active' : ''}}" bindtap="switchResultType" data-type="service">æœåŠ¡</view>
    <view class="tab-item {{activeType === 'merchant' ? 'active' : ''}}" bindtap="switchResultType" data-type="merchant">å•†å®¶</view>
  </scroll-view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading && currentPage === 1}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!isLoading && currentData.length === 0}}">
    <text class="empty-icon">ğŸ”</text>
    <text class="empty-title">æš‚æ— æœç´¢ç»“æœ</text>
    <text class="empty-desc">æ¢ä¸ªå…³é”®è¯è¯•è¯•å§</text>
  </view>

  <!-- æœç´¢ç»“æœåˆ—è¡¨ -->
  <view class="result-list" wx:else>
    <!-- å® ç‰©ç»“æœ -->
    <block wx:if="{{activeType === 'all' || activeType === 'pet'}}">
      <view class="section-title" wx:if="{{activeType === 'all'}}">å® ç‰©</view>
      <view class="pet-grid" wx:if="{{results.pets && results.pets.length > 0}}">
        <view class="pet-card" wx:for="{{results.pets}}" wx:key="id" bindtap="navigateToPetDetail" data-id="{{item.id}}">
          <image class="pet-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
          <view class="pet-info">
            <text class="pet-name">{{item.name}}</text>
            <text class="pet-meta">{{item.breed}} â€¢ {{item.age}} â€¢ {{item.gender === 'male' ? 'å…¬' : 'æ¯'}}</text>
            <text class="pet-price">Â¥{{item.price}}</text>
          </view>
        </view>
      </view>
      <view class="empty-section" wx:else>æš‚æ— ç›¸å…³å® ç‰©</view>
    </block>

    <!-- å•†å“ç»“æœ -->
    <block wx:if="{{activeType === 'all' || activeType === 'product'}}">
      <view class="section-title" wx:if="{{activeType === 'all'}}">å•†å“</view>
      <view class="product-grid" wx:if="{{results.products && results.products.length > 0}}">
        <view class="product-card" wx:for="{{results.products}}" wx:key="id" bindtap="navigateToProductDetail" data-id="{{item.id}}">
          <image class="product-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <text class="product-price">Â¥{{item.price}}</text>
            <text class="product-sales">é”€é‡: {{item.sales}}</text>
          </view>
        </view>
      </view>
      <view class="empty-section" wx:else>æš‚æ— ç›¸å…³å•†å“</view>
    </block>

    <!-- æœåŠ¡ç»“æœ -->
    <block wx:if="{{activeType === 'all' || activeType === 'service'}}">
      <view class="section-title" wx:if="{{activeType === 'all'}}">æœåŠ¡</view>
      <view class="service-list" wx:if="{{results.services && results.services.length > 0}}">
        <view class="service-item" wx:for="{{results.services}}" wx:key="id" bindtap="navigateToServiceDetail" data-id="{{item.id}}">
          <image class="service-image" src="{{item.image}}" mode="aspectFill"></image>
          <view class="service-info">
            <view class="service-header">
              <text class="service-name">{{item.name}}</text>
              <text class="service-price">Â¥{{item.price}}</text>
            </view>
            <text class="service-description">{{item.description}}</text>
            <text class="service-merchant">{{item.merchantName}}</text>
          </view>
        </view>
      </view>
      <view class="empty-section" wx:else>æš‚æ— ç›¸å…³æœåŠ¡</view>
    </block>

    <!-- å•†å®¶ç»“æœ -->
    <block wx:if="{{activeType === 'all' || activeType === 'merchant'}}">
      <view class="section-title" wx:if="{{activeType === 'all'}}">å•†å®¶</view>
      <view class="merchant-list" wx:if="{{results.merchants && results.merchants.length > 0}}">
        <view class="merchant-item" wx:for="{{results.merchants}}" wx:key="id" bindtap="navigateToMerchantDetail" data-id="{{item.id}}">
          <image class="merchant-avatar" src="{{item.logo}}" mode="aspectFill"></image>
          <view class="merchant-info">
            <view class="merchant-header">
              <text class="merchant-name">{{item.name}}</text>
              <view class="merchant-rating">
                <text class="rating-star">â­</text>
                <text>{{item.rating}}</text>
              </view>
            </view>
            <text class="merchant-address">{{item.address}}</text>
            <text class="merchant-service">{{item.services.join(' â€¢ ')}}</text>
          </view>
        </view>
      </view>
      <view class="empty-section" wx:else>æš‚æ— ç›¸å…³å•†å®¶</view>
    </block>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{!isLoading && hasMore}}">
    <text class="load-more-text" bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ­£åœ¨åŠ è½½æ›´å¤š -->
  <view class="loading-more" wx:if="{{isLoading && currentPage > 1}}">
    <text class="loading-more-text">æ­£åœ¨åŠ è½½...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more" wx:if="{{!isLoading && !hasMore && totalResults > 0}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>
</view>
