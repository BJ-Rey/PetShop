<!-- pages/merchant/setting/business-hours/business-hours.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="goBack">â†</text>
    <text class="page-title">è¥ä¸šæ—¶é—´è®¾ç½®</text>
  </view>

  <!-- æ‚¬æµ®ä¿å­˜æŒ‰é’® -->
  <view class="floating-save-btn" bindtap="saveBusinessHours">
    <text class="save-icon">ğŸ’¾</text>
    <text>ä¿å­˜</text>
  </view>

  <!-- æ¨¡å¼é€‰æ‹© -->
  <view class="setting-section card">
    <view class="section-title">è®¾ç½®æ¨¡å¼</view>
    <view class="mode-selector">
      <button 
        class="mode-btn {{selectedMode === 'same' ? 'active' : ''}}" 
        bindtap="selectMode" 
        data-mode="same"
      >
        ç»Ÿä¸€è®¾ç½®
      </button>
      <button 
        class="mode-btn {{selectedMode === 'differentiated' ? 'active' : ''}}" 
        bindtap="selectMode" 
        data-mode="differentiated"
      >
        å·®å¼‚åŒ–è®¾ç½®
      </button>
    </view>
  </view>

  <!-- ç»Ÿä¸€è®¾ç½®æ¨¡å¼ -->
  <view class="setting-section card" wx:if="{{selectedMode === 'same'}}">
    <view class="section-title">ç»Ÿä¸€è¥ä¸šæ—¶é—´</view>
    
    <!-- è¥ä¸šçŠ¶æ€ -->
    <view class="form-item">
      <text class="form-label">è¥ä¸šçŠ¶æ€</text>
      <view class="status-switch">
        <text class="status-text">{{sameModeStatus === 'open' ? 'è¥ä¸šä¸­' : 'ä¼‘æ¯'}}</text>
        <switch 
          checked="{{sameModeStatus === 'open'}}" 
          bindchange="toggleSameModeStatus"
        />
      </view>
    </view>

    <!-- è¥ä¸šæ—¶é—´åˆ—è¡¨ -->
    <view class="time-slots" wx:if="{{sameModeStatus === 'open'}}">
      <view class="time-slot" wx:for="{{sameModeTimeSlots}}" wx:key="index">
        <view class="time-slot-header">
          <text class="slot-label">æ—¶æ®µ {{index + 1}}</text>
          <button 
            class="delete-slot-btn" 
            wx:if="{{sameModeTimeSlots.length > 1}}" 
            bindtap="deleteSameModeTimeSlot" 
            data-index="{{index}}"
          >
            åˆ é™¤
          </button>
        </view>
        <view class="time-picker-container">
          <picker 
            class="time-picker" 
            mode="time" 
            value="{{item.start}}" 
            bindchange="updateSameModeTimeSlot" 
            data-index="{{index}}" 
            data-field="start"
          >
            <view class="picker-text">å¼€å§‹æ—¶é—´ï¼š{{item.start}}</view>
          </picker>
          <text class="time-separator">è‡³</text>
          <picker 
            class="time-picker" 
            mode="time" 
            value="{{item.end}}" 
            bindchange="updateSameModeTimeSlot" 
            data-index="{{index}}" 
            data-field="end"
          >
            <view class="picker-text">ç»“æŸæ—¶é—´ï¼š{{item.end}}</view>
          </picker>
        </view>
      </view>
      
      <!-- æ·»åŠ æ—¶æ®µæŒ‰é’® -->
      <button class="add-slot-btn" bindtap="addSameModeTimeSlot">+ æ·»åŠ è¥ä¸šæ—¶æ®µ</button>
    </view>
  </view>

  <!-- å·®å¼‚åŒ–è®¾ç½®æ¨¡å¼ -->
  <view class="setting-section card" wx:if="{{selectedMode === 'differentiated'}}">
    <view class="section-title">å·®å¼‚åŒ–è¥ä¸šæ—¶é—´</view>
    
    <!-- å·¥ä½œæ—¥ç±»å‹é€‰æ‹© -->
    <view class="workday-tabs">
      <button 
        class="tab-btn {{selectedWorkdayType === 'weekday' ? 'active' : ''}}" 
        bindtap="selectWorkdayType" 
        data-type="weekday"
      >
        å·¥ä½œæ—¥
      </button>
      <button 
        class="tab-btn {{selectedWorkdayType === 'weekend' ? 'active' : ''}}" 
        bindtap="selectWorkdayType" 
        data-type="weekend"
      >
        å‘¨æœ«
      </button>
      <button 
        class="tab-btn {{selectedWorkdayType === 'holiday' ? 'active' : ''}}" 
        bindtap="selectWorkdayType" 
        data-type="holiday"
      >
        èŠ‚å‡æ—¥
      </button>
    </view>

    <!-- é€‰ä¸­ç±»å‹çš„è®¾ç½® -->
    <view class="workday-settings">
      <!-- è¥ä¸šçŠ¶æ€ -->
      <view class="form-item">
        <text class="form-label">{{selectedWorkdayType === 'weekday' ? 'å·¥ä½œæ—¥' : selectedWorkdayType === 'weekend' ? 'å‘¨æœ«' : 'èŠ‚å‡æ—¥'}} çŠ¶æ€</text>
        <view class="status-switch">
          <text class="status-text">{{workdaySettings[selectedWorkdayType].status === 'open' ? 'è¥ä¸šä¸­' : 'ä¼‘æ¯'}}</text>
          <switch 
            checked="{{workdaySettings[selectedWorkdayType].status === 'open'}}" 
            bindchange="toggleWorkdayStatus"
          />
        </view>
      </view>

      <!-- è¥ä¸šæ—¶é—´åˆ—è¡¨ -->
      <view class="time-slots" wx:if="{{workdaySettings[selectedWorkdayType].status === 'open'}}">
        <view class="time-slot" wx:for="{{workdaySettings[selectedWorkdayType].timeSlots}}" wx:key="index">
          <view class="time-slot-header">
            <text class="slot-label">æ—¶æ®µ {{index + 1}}</text>
            <button 
              class="delete-slot-btn" 
              wx:if="{{workdaySettings[selectedWorkdayType].timeSlots.length > 1}}" 
              bindtap="deleteWorkdayTimeSlot" 
              data-index="{{index}}"
            >
              åˆ é™¤
            </button>
          </view>
          <view class="time-picker-container">
            <picker 
              class="time-picker" 
              mode="time" 
              value="{{item.start}}" 
              bindchange="updateWorkdayTimeSlot" 
              data-index="{{index}}" 
              data-field="start"
            >
              <view class="picker-text">å¼€å§‹æ—¶é—´ï¼š{{item.start}}</view>
            </picker>
            <text class="time-separator">è‡³</text>
            <picker 
              class="time-picker" 
              mode="time" 
              value="{{item.end}}" 
              bindchange="updateWorkdayTimeSlot" 
              data-index="{{index}}" 
              data-field="end"
            >
              <view class="picker-text">ç»“æŸæ—¶é—´ï¼š{{item.end}}</view>
            </picker>
          </view>
        </view>
        
        <!-- æ·»åŠ æ—¶æ®µæŒ‰é’® -->
        <button class="add-slot-btn" bindtap="addWorkdayTimeSlot">+ æ·»åŠ è¥ä¸šæ—¶æ®µ</button>
      </view>
    </view>

    <!-- èŠ‚å‡æ—¥ç®¡ç† -->
    <view class="holiday-management" wx:if="{{selectedWorkdayType === 'holiday'}}">
      <view class="section-subtitle">èŠ‚å‡æ—¥ç®¡ç†</view>
      <button class="manage-holiday-btn" bindtap="manageHolidays">ç®¡ç†èŠ‚å‡æ—¥</button>
      <view class="holiday-list" wx:if="{{holidayList.length > 0}}">
        <view class="holiday-item" wx:for="{{holidayList}}" wx:key="date">
          <text class="holiday-date">{{item.date}}</text>
          <text class="holiday-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢„è§ˆ -->
  <view class="setting-section card">
    <view class="section-title">é¢„è§ˆ</view>
    <view class="preview-container">
      <view class="preview-item" wx:for="{{previewDays}}" wx:key="day">
        <text class="preview-day">{{item.day}}</text>
        <text class="preview-status">{{item.status === 'open' ? 'è¥ä¸š' : 'ä¼‘æ¯'}}</text>
        <text class="preview-time" wx:if="{{item.status === 'open'}}">{{item.time}}</text>
      </view>
    </view>
  </view>
</view>