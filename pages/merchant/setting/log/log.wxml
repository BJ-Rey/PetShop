<!-- pages/merchant/setting/log/log.wxml -->
<wxs module="utils">
  module.exports.formatDate = function(dateString) {
    if (!dateString) return '';
    var date = getDate(dateString);
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    var day = date.getDate();
    var hour = date.getHours();
    var minute = date.getMinutes();
    var second = date.getSeconds();
    
    if (month < 10) month = '0' + month;
    if (day < 10) day = '0' + day;
    if (hour < 10) hour = '0' + hour;
    if (minute < 10) minute = '0' + minute;
    if (second < 10) second = '0' + second;
    
    return year + '-' + month + '-' + day + ' ' + hour + ':' + minute + ':' + second;
  }
  
  module.exports.getTypeText = function(type) {
    var map = {
      'add': 'æ·»åŠ ',
      'edit': 'ç¼–è¾‘',
      'delete': 'åˆ é™¤',
      'publish': 'ä¸Šä¸‹æ¶',
      'login': 'ç™»å½•/é€€å‡º'
    };
    return map[type] || 'æœªçŸ¥';
  }
  
  module.exports.getModuleText = function(moduleName) {
    var map = {
      'product': 'å•†å“ç®¡ç†',
      'service': 'æœåŠ¡ç®¡ç†',
      'order': 'è®¢å•ç®¡ç†',
      'finance': 'è´¢åŠ¡ç®¡ç†',
      'setting': 'ç³»ç»Ÿè®¾ç½®'
    };
    return map[moduleName] || 'æœªçŸ¥æ¨¡å—';
  }
</wxs>

<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">â†</text>
    <text class="page-title">æ“ä½œæ—¥å¿—</text>
    <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
  </view>

  <!-- æœç´¢å’Œç­›é€‰æ  -->
  <view class="search-filter-bar">
    <input 
      class="search-input" 
      placeholder="æœç´¢æ“ä½œæè¿°æˆ–æ“ä½œäººå‘˜" 
      bindinput="onSearch" 
      value="{{filter.keyword}}"
    />
    <button class="filter-btn" bindtap="toggleFilterPanel">
      <text class="filter-icon">ğŸ”</text>
      <text class="filter-text">ç­›é€‰</text>
    </button>
  </view>

  <!-- ç­›é€‰é¢æ¿ -->
  <view class="filter-panel" wx:if="{{showFilterPanel}}">
    <view class="filter-section">
      <text class="filter-title">æ“ä½œç±»å‹</text>
      <view class="filter-options">
        <view 
          class="filter-option {{filter.type === 'all' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="type"
          data-value="all"
        >
          å…¨éƒ¨
        </view>
        <view 
          class="filter-option {{filter.type === 'add' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="type"
          data-value="add"
        >
          æ·»åŠ 
        </view>
        <view 
          class="filter-option {{filter.type === 'edit' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="type"
          data-value="edit"
        >
          ç¼–è¾‘
        </view>
        <view 
          class="filter-option {{filter.type === 'delete' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="type"
          data-value="delete"
        >
          åˆ é™¤
        </view>
        <view 
          class="filter-option {{filter.type === 'publish' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="type"
          data-value="publish"
        >
          ä¸Šæ¶/ä¸‹æ¶
        </view>
        <view 
          class="filter-option {{filter.type === 'login' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="type"
          data-value="login"
        >
          ç™»å½•/é€€å‡º
        </view>
      </view>
    </view>
    
    <view class="filter-section">
      <text class="filter-title">æ“ä½œæ¨¡å—</text>
      <view class="filter-options">
        <view 
          class="filter-option {{filter.module === 'all' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="module"
          data-value="all"
        >
          å…¨éƒ¨
        </view>
        <view 
          class="filter-option {{filter.module === 'product' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="module"
          data-value="product"
        >
          å•†å“ç®¡ç†
        </view>
        <view 
          class="filter-option {{filter.module === 'service' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="module"
          data-value="service"
        >
          æœåŠ¡ç®¡ç†
        </view>
        <view 
          class="filter-option {{filter.module === 'order' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="module"
          data-value="order"
        >
          è®¢å•ç®¡ç†
        </view>
        <view 
          class="filter-option {{filter.module === 'finance' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="module"
          data-value="finance"
        >
          è´¢åŠ¡ç®¡ç†
        </view>
        <view 
          class="filter-option {{filter.module === 'setting' ? 'active' : ''}}" 
          bindtap="changeFilter" 
          data-type="module"
          data-value="setting"
        >
          ç³»ç»Ÿè®¾ç½®
        </view>
      </view>
    </view>
    
    <view class="filter-actions">
      <button class="reset-btn" bindtap="resetFilter">é‡ç½®</button>
      <button class="confirm-btn" type="primary" bindtap="applyFilter">ç¡®è®¤</button>
    </view>
  </view>

  <!-- æ—¥å¿—åˆ—è¡¨ -->
  <view class="log-list">
    <view class="empty-state" wx:if="{{!isLoading && logs.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— æ“ä½œæ—¥å¿—</text>
    </view>
    
    <view class="loading-state" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <block wx:else>
      <view class="log-item card" wx:for="{{logs}}" wx:key="id">
        <view class="log-header">
          <view class="log-meta">
            <text class="log-operator">{{item.operator}}</text>
            <text class="log-time">{{utils.formatDate(item.createdAt)}}</text>
          </view>
          <view class="log-type-badge {{item.type}}">
            {{utils.getTypeText(item.type)}}
          </view>
        </view>
        
        <view class="log-content">
          <text class="log-description">{{item.description}}</text>
          <view class="log-details">
            <text class="log-module">æ¨¡å—ï¼š{{utils.getModuleText(item.module)}}</text>
            <text class="log-ip">IPï¼š{{item.ip}}</text>
          </view>
          <text class="log-extra" wx:if="{{item.extra}}">{{item.extra}}</text>
        </view>
      </view>
    </block>
  </view>
</view>