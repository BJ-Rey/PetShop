<!--pages/merchant/pet/detail/detail.wxml-->
<view class="container merchant-theme">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">â†</text>
    <text class="page-title">å® ç‰©è¯¦æƒ…(å•†å®¶ç‰ˆ)</text>
  </view>

  <block wx:if="{{!isLoading && pet}}">
    <!-- è½®æ’­å›¾ -->
    <swiper indicator-dots="{{indicatorDots}}" autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}" class="pet-swiper">
      <block wx:for="{{pet.images}}" wx:key="index">
        <swiper-item>
          <image src="{{item}}" class="slide-image" mode="aspectFill"></image>
          <!-- çŠ¶æ€æ ‡ç­¾ -->
          <view class="status-tag {{pet.isOrdered ? 'booked' : 'available'}}">
            {{pet.statusText}}
          </view>
        </swiper-item>
      </block>
    </swiper>

    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="info-section card">
      <view class="price-row">
        <text class="price">Â¥{{pet.priceStr}}</text>
        <text class="deposit">å®šé‡‘: Â¥{{pet.deposit}}</text>
        <text class="balance-status" wx:if="{{pet.isOrdered}}">{{pet.balanceStatusText}}</text>
      </view>
      <view class="name">{{pet.name}}</view>
      <view class="meta-tags">
        <text class="tag">{{pet.breed}}</text>
        <text class="tag">{{pet.age}}</text>
        <text class="tag">{{pet.gender === 'male' ? 'å…¬' : 'æ¯'}}</text>
        <text class="tag">{{pet.color}}</text>
      </view>
      
      <!-- æ•°æ®ç»Ÿè®¡ -->
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-val">{{pet.sales || 0}}</text>
          <text class="stat-label">é”€é‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-val">{{pet.rating || 0}}</text>
          <text class="stat-label">è¯„åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-val">1024</text>
          <text class="stat-label">æµè§ˆ</text>
        </view>
        <view class="stat-item">
          <text class="stat-val">56</text>
          <text class="stat-label">æ”¶è—</text>
        </view>
      </view>
    </view>

    <!-- ç®¡ç†æ“ä½œåŒº -->
    <view class="manage-section card">
        <view class="section-title">ç®¡ç†æ“ä½œ</view>
        
        <view class="manage-row">
            <view class="manage-item">
                <text class="manage-label">å½“å‰çŠ¶æ€</text>
                <picker bindchange="onStatusChange" value="{{statusIndex}}" range="{{statusLabels}}" class="status-picker">
                    <view class="picker-inner">
                        <text class="current-status {{pet.status}}">{{statusLabels[statusIndex]}}</text>
                        <text class="arrow">></text>
                    </view>
                </picker>
            </view>
        </view>
        
        <view class="manage-row">
            <view class="manage-item">
                <text class="manage-label">åº“å­˜ç®¡ç†</text>
                <view class="picker-inner">
                    <text class="action-text">1 (å”¯ä¸€)</text>
                    <text class="arrow">></text>
                </view>
            </view>
        </view>
        
        <view class="manage-row" bindtap="navigateToPromotion">
            <view class="manage-item">
                <text class="manage-label">ä¿ƒé”€æ´»åŠ¨</text>
                <view class="picker-inner">
                    <text class="action-text">å»è®¾ç½®</text>
                    <text class="arrow">></text>
                </view>
            </view>
        </view>
    </view>

    <!-- è¯¦ç»†ä¿¡æ¯ -->
    <view class="detail-section card">
      <view class="section-title">è¯¦ç»†ä»‹ç»</view>
      <view class="content">{{pet.description || 'æš‚æ— æè¿°'}}</view>
    </view>

    <!-- å¥åº·è®°å½• -->
    <view class="health-section card">
      <view class="section-title">å¥åº·æ¡£æ¡ˆ</view>
      <view class="health-item">
        <text class="label">å¥åº·çŠ¶å†µ:</text>
        <text class="value {{pet.hasDisease ? 'danger' : 'success'}}">{{pet.hasDisease ? 'æœ‰å¼‚å¸¸' : 'å¥åº·'}}</text>
      </view>
      <view class="record-list" wx:if="{{pet.vaccineRecords.length > 0}}">
        <view class="sub-title">ç–«è‹—è®°å½•</view>
        <view class="record-item" wx:for="{{pet.vaccineRecords}}" wx:key="id">
          <text class="record-name">{{item.name}}</text>
          <text class="record-date">{{item.date}}</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  (å•†å®¶ä¸“å±) -->
    <view class="merchant-bottom-bar">
      <view class="action-btn secondary" bindtap="showPriceModal" hover-class="btn-hover">
        <text class="icon">ğŸ’°</text>
        <text>ä¿®æ”¹ä»·æ ¼</text>
      </view>
      <view class="action-btn primary" bindtap="navigateToEdit" hover-class="btn-hover">
        <text class="icon">ğŸ“</text>
        <text>ç¼–è¾‘ä¿¡æ¯</text>
      </view>
    </view>
  </block>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¿®æ”¹ä»·æ ¼å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showPriceModal}}" bindtap="hidePriceModal"></view>
  <view class="price-modal" wx:if="{{showPriceModal}}">
    <view class="modal-header">
      <text class="title">ä¿®æ”¹ä»·æ ¼</text>
      <text class="close" bindtap="hidePriceModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="input-group">
        <text class="currency">Â¥</text>
        <input type="digit" value="{{newPrice}}" bindinput="onPriceInput" class="price-input" focus="{{showPriceModal}}" />
      </view>
      <view class="deposit-preview">
        é¢„è®¡å®šé‡‘ (30%): <text class="highlight">Â¥{{newDeposit}}</text>
      </view>
    </view>
    <view class="modal-footer">
      <button class="modal-btn cancel" bindtap="hidePriceModal">å–æ¶ˆ</button>
      <button class="modal-btn confirm" bindtap="confirmUpdatePrice">ç¡®è®¤ä¿®æ”¹</button>
    </view>
  </view>
</view>
