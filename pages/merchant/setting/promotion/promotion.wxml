<!-- pages/merchant/setting/promotion/promotion.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="goBack">â†</text>
    <text class="page-title">ä¼˜æƒ æ´»åŠ¨è®¾ç½®</text>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab-item {{activeTab === 'active' ? 'active' : ''}}" bindtap="switchTab" data-tab="active">è¿›è¡Œä¸­</view>
    <view class="tab-item {{activeTab === 'scheduled' ? 'active' : ''}}" bindtap="switchTab" data-tab="scheduled">æœªå¼€å§‹</view>
    <view class="tab-item {{activeTab === 'ended' ? 'active' : ''}}" bindtap="switchTab" data-tab="ended">å·²ç»“æŸ</view>
  </view>

  <!-- æ´»åŠ¨åˆ—è¡¨ -->
  <view class="promotion-list" wx:if="{{filteredPromotions.length > 0}}">
    <view class="promotion-item" wx:for="{{filteredPromotions}}" wx:key="id">
      <view class="promotion-status-badge status-{{item.status}}">
        {{item.status === 'active' ? 'è¿›è¡Œä¸­' : item.status === 'scheduled' ? 'æœªå¼€å§‹' : 'å·²ç»“æŸ'}}
      </view>
      
      <view class="promotion-header">
        <text class="promotion-title">{{item.title}}</text>
        <text class="promotion-type">{{item.type === 'discount' ? 'æŠ˜æ‰£åˆ¸' : 'æ»¡å‡åˆ¸'}}</text>
      </view>
      
      <view class="promotion-content">
        <view class="info-row">
          <text class="info-label">ä¼˜æƒ å†…å®¹ï¼š</text>
          <text class="info-value" wx:if="{{item.type === 'discount'}}">{{item.value}}æŠ˜</text>
          <text class="info-value" wx:else>å‡{{item.value}}å…ƒ</text>
        </view>
        <view class="info-row">
          <text class="info-label">ä½¿ç”¨é—¨æ§›ï¼š</text>
          <text class="info-value">{{item.minSpend > 0 ? 'æ»¡' + item.minSpend + 'å…ƒå¯ç”¨' : 'æ— é—¨æ§›'}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">æ´»åŠ¨æ—¶é—´ï¼š</text>
          <text class="info-value">{{item.startTime}} è‡³ {{item.endTime}}</text>
        </view>
      </view>
      
      <view class="promotion-footer">
        <view class="action-btn edit-btn" bindtap="showEditForm" data-id="{{item.id}}" wx:if="{{item.status !== 'ended'}}">ç¼–è¾‘</view>
        <view class="action-btn end-btn" bindtap="endPromotion" data-id="{{item.id}}" wx:if="{{item.status === 'active'}}">ç»“æŸ</view>
        <view class="action-btn delete-btn" bindtap="deletePromotion" data-id="{{item.id}}" wx:if="{{item.status !== 'active'}}">åˆ é™¤</view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <text class="empty-icon">ğŸ«</text>
    <text class="empty-text">æš‚æ— ç›¸å…³æ´»åŠ¨</text>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-promotion-btn" bindtap="showAddForm">
    <text>+ åˆ›å»ºæ´»åŠ¨</text>
  </view>

  <!-- å…¨å±è¡¨å•å¼¹çª— -->
  <view class="form-modal" wx:if="{{showForm}}">
    <view class="modal-header">
      <view class="close-btn" bindtap="hideForm">å–æ¶ˆ</view>
      <view class="modal-title">{{formTitle}}</view>
      <view class="save-btn" bindtap="savePromotion">ä¿å­˜</view>
    </view>
    
    <view class="modal-body">
      <view class="form-group">
        <view class="form-item">
          <text class="form-label">æ´»åŠ¨åç§° <text class="required">*</text></text>
          <input class="form-input" placeholder="è¯·è¾“å…¥æ´»åŠ¨åç§°" value="{{formData.title}}" bindinput="onInput" data-field="title" />
        </view>
        
        <view class="form-item">
          <text class="form-label">ä¼˜æƒ ç±»å‹</text>
          <radio-group class="form-radio-group" bindchange="onInput" data-field="type">
            <label class="radio-label" wx:for="{{typeOptions}}" wx:key="value">
              <radio value="{{item.value}}" checked="{{formData.type === item.value}}" color="#07c160"/>
              <text>{{item.name}}</text>
            </label>
          </radio-group>
        </view>
        
        <view class="form-item">
          <text class="form-label">{{formData.type === 'discount' ? 'æŠ˜æ‰£åŠ›åº¦' : 'å‡å…é‡‘é¢'}} <text class="required">*</text></text>
          <input 
            class="form-input" 
            type="digit" 
            placeholder="{{formData.type === 'discount' ? 'è¯·è¾“å…¥æŠ˜æ‰£(å¦‚8.5)' : 'è¯·è¾“å…¥é‡‘é¢'}}" 
            value="{{formData.value}}" 
            bindinput="onInput" 
            data-field="value" 
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">ä½¿ç”¨é—¨æ§›</text>
          <input 
            class="form-input" 
            type="digit" 
            placeholder="æ»¡å¤šå°‘å…ƒå¯ç”¨(0ä¸ºæ— é—¨æ§›)" 
            value="{{formData.minSpend}}" 
            bindinput="onInput" 
            data-field="minSpend" 
          />
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-item">
          <text class="form-label">å¼€å§‹æ—¶é—´ <text class="required">*</text></text>
          <picker mode="date" value="{{formData.startTime}}" bindchange="onDateChange" data-field="startTime">
            <view class="picker-text {{!formData.startTime ? 'placeholder' : ''}}">
              {{formData.startTime || 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´'}}
            </view>
          </picker>
        </view>
        
        <view class="form-item">
          <text class="form-label">ç»“æŸæ—¶é—´ <text class="required">*</text></text>
          <picker mode="date" value="{{formData.endTime}}" bindchange="onDateChange" data-field="endTime">
            <view class="picker-text {{!formData.endTime ? 'placeholder' : ''}}">
              {{formData.endTime || 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´'}}
            </view>
          </picker>
        </view>
      </view>
      
      <view class="form-group">
        <view class="form-item" style="border-bottom: none;">
          <text class="form-label">æ´»åŠ¨è¯´æ˜</text>
        </view>
        <textarea 
          class="form-textarea" 
          placeholder="è¯·è¾“å…¥æ´»åŠ¨è§„åˆ™è¯´æ˜..." 
          value="{{formData.description}}" 
          bindinput="onInput" 
          data-field="description"
          style="width: 100%; height: 200rpx; padding: 0 0 30rpx 0; font-size: 28rpx;"
        />
      </view>
    </view>
  </view>
</view>
