<!-- pages/merchant/pet/manage/manage.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">è¿”å›</text>
    <text class="page-title">å® ç‰©ç®¡ç†</text>
    <view class="action-buttons">
      <button class="logout-btn" bindtap="logout">
        é€€å‡ºç™»å½•
      </button>
      <button class="add-btn" bindtap="addPet">
        + æ·»åŠ å® ç‰©
      </button>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <image src="/images/æœç´¢_search.svg" class="search-icon" mode="aspectFit"></image>
      <input 
        type="text" 
        placeholder="æœç´¢å® ç‰©åç§°ã€å“ç§æˆ–å¹´é¾„" 
        class="search-input" 
        value="{{filters.keyword}}"
        bindinput="onKeywordInput"
      />
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œåŒº -->
  <view class="batch-actions-bar">
    <view class="batch-select-all" bindtap="selectAllPets">
      <checkbox checked="{{isAllSelected}}" class="select-all-checkbox"></checkbox>
      <text class="select-all-text">å…¨é€‰</text>
    </view>
    <view class="batch-action-buttons">
      <button 
        class="batch-btn batch-toggle-btn {{batchActionsEnabled ? 'enabled' : 'disabled'}}"
        bindtap="batchToggleStatus"
        disabled="{{!batchActionsEnabled}}"
      >
        æ‰¹é‡ä¸Šä¸‹æ¶
      </button>
      <button 
        class="batch-btn batch-delete-btn {{batchActionsEnabled ? 'enabled' : 'disabled'}}"
        bindtap="batchDelete"
        disabled="{{!batchActionsEnabled}}"
      >
        æ‰¹é‡åˆ é™¤
      </button>
    </view>
  </view>

  <!-- é«˜çº§ç­›é€‰åŒº -->
  <view class="advanced-filter-bar">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="filter-section">
      <text class="filter-section-label">çŠ¶æ€:</text>
      <view class="filter-options">
        <text 
          class="filter-option {{filters.status === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="status" 
          data-value="all"
        >
          å…¨éƒ¨
        </text>
        <text 
          class="filter-option {{filters.status === 'published' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="status" 
          data-value="published"
        >
          ä¸Šæ¶
        </text>
        <text 
          class="filter-option {{filters.status === 'unpublished' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="status" 
          data-value="unpublished"
        >
          ä¸‹æ¶
        </text>
      </view>
    </view>
    
    <!-- æ˜¯å¦æœ‰äººä¸‹å®šç­›é€‰ -->
    <view class="filter-section">
      <text class="filter-section-label">ä¸‹å®šçŠ¶æ€:</text>
      <view class="filter-options">
        <text 
          class="filter-option {{filters.isOrdered === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="isOrdered" 
          data-value="all"
        >
          å…¨éƒ¨
        </text>
        <text 
          class="filter-option {{filters.isOrdered === 'yes' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="isOrdered" 
          data-value="yes"
        >
          å·²ä¸‹å®š
        </text>
        <text 
          class="filter-option {{filters.isOrdered === 'no' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="isOrdered" 
          data-value="no"
        >
          æœªä¸‹å®š
        </text>
      </view>
    </view>
    
    <!-- å“ç±»ç­›é€‰ -->
    <view class="filter-section">
      <text class="filter-section-label">å“ç±»:</text>
      <view class="filter-options">
        <text 
          class="filter-option {{filters.category === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="category" 
          data-value="all"
        >
          å…¨éƒ¨
        </text>
        <text 
          class="filter-option {{filters.category === 'ç‹—' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="category" 
          data-value="ç‹—"
        >
          ç‹—
        </text>
        <text 
          class="filter-option {{filters.category === 'çŒ«' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="category" 
          data-value="çŒ«"
        >
          çŒ«
        </text>
      </view>
    </view>
    
    <!-- æ€§åˆ«ç­›é€‰ -->
    <view class="filter-section">
      <text class="filter-section-label">æ€§åˆ«:</text>
      <view class="filter-options">
        <text 
          class="filter-option {{filters.gender === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="gender" 
          data-value="all"
        >
          å…¨éƒ¨
        </text>
        <text 
          class="filter-option {{filters.gender === 'male' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="gender" 
          data-value="male"
        >
          å…¬
        </text>
        <text 
          class="filter-option {{filters.gender === 'female' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="gender" 
          data-value="female"
        >
          æ¯
        </text>
      </view>
    </view>
    
    <!-- æ€§æ ¼ç­›é€‰ -->
    <view class="filter-section">
      <text class="filter-section-label">æ€§æ ¼:</text>
      <view class="filter-options">
        <text 
          class="filter-option {{filters.personality === 'all' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="personality" 
          data-value="all"
        >
          å…¨éƒ¨
        </text>
        <text 
          class="filter-option {{filters.personality === 'æ¸©é¡º' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="personality" 
          data-value="æ¸©é¡º"
        >
          æ¸©é¡º
        </text>
        <text 
          class="filter-option {{filters.personality === 'æ´»æ³¼' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="personality" 
          data-value="æ´»æ³¼"
        >
          æ´»æ³¼
        </text>
        <text 
          class="filter-option {{filters.personality === 'å®‰é™' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="personality" 
          data-value="å®‰é™"
        >
          å®‰é™
        </text>
        <text 
          class="filter-option {{filters.personality === 'è°ƒçš®' ? 'active' : ''}}"
          bindtap="onFilterChange" 
          data-type="personality" 
          data-value="è°ƒçš®"
        >
          è°ƒçš®
        </text>
      </view>
    </view>
  </view>

  <!-- æ’åºæ  -->
  <view class="sort-bar">
    <text class="sort-label">æ’åº:</text>
    <view class="sort-options">
      <view class="sort-option" bindtap="changeSortField" data-field="sort">
        <text>æ’åºä¼˜å…ˆçº§</text>
        <text class="sort-arrow {{sortField === 'sort' ? (sortOrder === 'asc' ? 'asc' : 'desc') : ''}}">
          {{sortField === 'sort' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : 'â†•'}}
        </text>
      </view>
      <view class="sort-option" bindtap="changeSortField" data-field="createdAt">
        <text>åˆ›å»ºæ—¶é—´</text>
        <text class="sort-arrow {{sortField === 'createdAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}">
          {{sortField === 'createdAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : 'â†•'}}
        </text>
      </view>
      <view class="sort-option" bindtap="changeSortField" data-field="updatedAt">
        <text>æ›´æ–°æ—¶é—´</text>
        <text class="sort-arrow {{sortField === 'updatedAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : ''}}">
          {{sortField === 'updatedAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : 'â†•'}}
        </text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{isLoading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error" wx:elif="{{error}}">
    <text class="error-icon">âŒ</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadPets">
      é‡è¯•
    </button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:elif="{{filteredPets.length === 0}}">
    <text class="empty-icon">ğŸ¶</text>
    <text class="empty-text">æš‚æ— å® ç‰©æ•°æ®</text>
    <button class="add-btn empty-btn" bindtap="addPet">
      + æ·»åŠ ç¬¬ä¸€ä¸ªå® ç‰©
    </button>
  </view>

  <!-- å® ç‰©åˆ—è¡¨ -->
  <view class="pet-list" wx:else>
    <view class="pet-item" wx:for="{{filteredPets}}" wx:key="id">
      <!-- é€‰æ‹©å¤é€‰æ¡† -->
      <view class="pet-select">
        <checkbox 
          checked="{{selectedPetIds.includes(item.id)}}" 
          class="pet-checkbox"
          bindtap="selectPet"
          data-id="{{item.id}}"
        ></checkbox>
      </view>
      
      <!-- å® ç‰©åŸºæœ¬ä¿¡æ¯ -->
      <view class="pet-info">
        <image src="{{item.avatar}}" class="pet-avatar" mode="aspectFill"></image>
        <view class="pet-details">
          <view class="pet-header">
            <text class="pet-name">{{item.name}}</text>
            <view class="pet-statuses">
              <text class="pet-status {{item.status}}">
                {{item.status === 'published' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}
              </text>
              <text class="pet-order-status {{item.isOrdered ? 'ordered' : 'not-ordered'}}">
                {{item.isOrdered ? 'å·²ä¸‹å®š' : 'æœªä¸‹å®š'}}
              </text>
            </view>
          </view>
          <text class="pet-meta">{{item.category}} â€¢ {{item.breed}} â€¢ {{item.age}} â€¢ {{item.gender === 'male' ? 'å…¬' : 'æ¯'}} â€¢ {{item.color}} â€¢ {{item.personality}}</text>
          <view class="pet-time-info">
            <text class="pet-time">åˆ›å»ºæ—¶é—´: {{item.createdAt.split('T')[0]}}</text>
            <text class="pet-time">æ›´æ–°æ—¶é—´: {{item.updatedAt.split('T')[0]}}</text>
          </view>
        </view>
      </view>
      
      <!-- æ“ä½œåŒºåŸŸ -->
      <view class="pet-actions">
        <!-- æ’åºç¼–è¾‘ -->
        <view class="sort-edit" wx:if="{{editingPetId === item.id}}">
          <input 
            type="number" 
            value="{{item.sort}}" 
            class="sort-input" 
            bindconfirm="updateSort"
            bindblur="cancelEditSort"
            auto-focus
          />
        </view>
        <view class="sort-display" wx:else>
          <text class="sort-label">æ’åº:</text>
          <text class="sort-value" bindtap="startEditSort" data-id="{{item.id}}">{{item.sort}}</text>
        </view>
        
        <!-- æ“ä½œæŒ‰é’®ç»„ -->
        <view class="action-buttons">
          <button 
            class="action-btn status-btn {{item.status === 'published' ? 'unpublish' : 'publish'}}"
            bindtap="togglePetStatus"
            data-id="{{item.id}}"
          >
            {{item.status === 'published' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}
          </button>
          <button 
            class="action-btn edit-btn"
            bindtap="editPet"
            data-id="{{item.id}}"
          >
            ç¼–è¾‘
          </button>
          <button 
            class="action-btn delete-btn"
            bindtap="deletePet"
            data-id="{{item.id}}"
            data-name="{{item.name}}"
          >
            åˆ é™¤
          </button>
          <button 
            class="action-btn view-btn"
            bindtap="viewPetDetail"
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>
  </view>
</view>