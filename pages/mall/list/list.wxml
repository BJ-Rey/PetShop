<!--pages/mall/list/list.wxml-->
<view class="container">
  <auth-modal id="auth-modal" />
  <global-cart />
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">â†</text>
    <text class="page-title">çŒ«å’ªå•†åŸ</text>
  </view>

  <!-- æœç´¢ -->
  <view class="top-bar">
    <view class="search-box">
      <input type="text" placeholder="æœç´¢çŒ«å’ªæˆ–å•†å“" bindinput="onSearchInput" bindconfirm="onSearch" value="{{searchKeyword}}" />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
  </view>

  <!-- ç­›é€‰æŒ‰é’® -->
  <view class="filter-buttons" wx:if="{{!isSearching}}">
    <view class="filter-btn {{currentFilter === 'cat' ? 'active' : ''}}" bindtap="switchFilter" data-filter="cat">çŒ«å’ª</view>
    <view class="filter-btn {{currentFilter === 'product' ? 'active' : ''}}" bindtap="switchFilter" data-filter="product">ç”¨å“</view>
  </view>

  <!-- éæœç´¢çŠ¶æ€æ˜¾ç¤ºå†…å®¹ -->
  <block wx:if="{{!isSearching}}">
    <!-- æ¨èå•†å“è½®æ’­ -->
    <view class="banner-section">
      <swiper indicator-dots="{{indicatorDots}}" autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
        <block wx:for="{{bannerList}}" wx:key="id">
          <swiper-item>
            <image src="{{item.image}}" class="banner-image" mode="aspectFill" bindtap="navigateToBannerLink" data-link="{{item.link}}"></image>
          </swiper-item>
        </block>
      </swiper>
    </view>

    <!-- çƒ­é—¨å•†å“ (ä»…åœ¨æŸ¥çœ‹ç”¨å“æ—¶æ˜¾ç¤ºï¼Œæˆ–è€…ä¸€ç›´æ˜¾ç¤ºï¼Ÿç”¨æˆ·æ²¡è¯´ï¼Œæš‚ä¿ç•™ä½†ä»…åœ¨ç”¨å“Tabæ˜¾ç¤ºæ¯”è¾ƒåˆç†ï¼Œä½†ç”¨æˆ·è¯´çŒ«å’ªé¡µé¢è¦æ•´åˆï¼Œæ‰€ä»¥çŒ«å’ªTabä¸‹å¯èƒ½ä¸éœ€è¦çƒ­é—¨å•†å“ï¼Œæˆ–è€…æ˜¾ç¤ºçƒ­é—¨çŒ«å’ªã€‚ä¸ºç®€åŒ–ï¼Œä»…åœ¨ç”¨å“Tabæ˜¾ç¤º) -->
    <view class="hot-products" wx:if="{{currentFilter === 'product' && hotProducts.length > 0}}">
      <view class="section-header">
        <text class="section-title">çƒ­é—¨å•†å“</text>
        <text class="more" bindtap="navigateToAllProducts">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      <scroll-view scroll-x="true" class="hot-products-scroll" enable-flex>
        <block wx:for="{{hotProducts}}" wx:key="id">
          <view class="hot-product-item" bindtap="navigateToProductDetail" data-id="{{item.id}}">
            <image src="{{item.image}}" class="product-image"></image>
            <text class="product-name">{{item.name}}</text>
            <text class="product-price">Â¥{{item.price}}</text>
            <text class="product-sales">é”€é‡ {{item.sales}}</text>
          </view>
        </block>
      </scroll-view>
    </view>

    <!-- åˆ—è¡¨å±•ç¤ºåŒºåŸŸ -->
    <view class="product-list">
      <view class="section-header">
        <text class="section-title">{{currentFilter === 'cat' ? 'ç²¾é€‰çŒ«å’ª' : 'å…¨éƒ¨å•†å“'}}</text>
      </view>
      
      <!-- çŒ«å’ªåˆ—è¡¨ -->
      <view class="product-grid" wx:if="{{currentFilter === 'cat'}}">
        <block wx:if="{{pets.length > 0}}">
          <block wx:for="{{pets}}" wx:key="id">
            <view class="product-card" bindtap="navigateToPetDetail" data-id="{{item.id}}">
              <image src="{{item.avatar}}" class="product-card-image" mode="aspectFill"></image>
              <pet-status-tag status="{{item.status}}" statusText="{{item.statusText}}" style="position: absolute; top: 15rpx; left: 15rpx; z-index: 10;"></pet-status-tag>
              <view class="product-card-info">
                <text class="product-card-name">{{item.name}}</text>
                <view class="product-card-meta">
                   <text class="pet-gender">{{item.gender === 'male' ? 'å…¬' : 'æ¯'}}</text>
                   <text class="pet-age">{{item.age}}</text>
                </view>
                <view class="product-card-price">
                  <text class="current-price">Â¥{{item.price}}</text>
                  <text class="deposit-info">å®šé‡‘ Â¥{{item.deposit}}</text>
                </view>
                <block wx:if="{{!item.isOrdered}}">
                    <button class="buy-btn" catchtap="navigateToPetDetail" data-id="{{item.id}}">ä¸‹å®š</button>
                </block>
                <block wx:else>
                    <button class="buy-btn" catchtap="showContactModal" data-petid="{{item.id}}">è”ç³»å•†å®¶</button>
                </block>
              </view>
            </view>
          </block>
        </block>
        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty" wx:else>
            <text>æš‚æ— çŒ«å’ªä¿¡æ¯</text>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="product-grid" wx:if="{{currentFilter === 'product'}}">
        <block wx:for="{{products}}" wx:key="id">
          <view class="product-card" bindtap="navigateToProductDetail" data-id="{{item.id}}">
            <image src="{{item.image}}" class="product-card-image" mode="aspectFill"></image>
            <view class="product-card-info">
              <text class="product-card-name">{{item.name}}</text>
              <view class="product-card-meta">
                <text class="product-card-rating">{{item.rating}} â˜…</text>
                <text class="product-card-sales">é”€é‡ {{item.sales}}</text>
              </view>
              <view class="product-card-price">
                <text class="current-price">Â¥{{item.price}}</text>
                <text class="original-price" wx:if="{{item.originalPrice > item.price}}">Â¥{{item.originalPrice}}</text>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </block>

  <!-- è”ç³»å•†å®¶æ¨¡æ€æ¡† -->
  <view class="modal-mask" wx:if="{{showContactModal}}" bindtap="hideContactModal"></view>
  <view class="contact-modal" wx:if="{{showContactModal}}">
    <view class="modal-header">
      <text class="modal-title">è”ç³»å•†å®¶</text>
      <text class="close-btn" bindtap="hideContactModal">Ã—</text>
    </view>
    <view class="modal-content">
      <!-- å¾®ä¿¡äºŒç»´ç  -->
      <view class="contact-method">
        <text class="method-title">å¾®ä¿¡è”ç³»</text>
        <view class="qrcode-container">
          <image src="{{merchantInfo.wechatQrcode || 'https://via.placeholder.com/200'}}"></image>
          <text class="qrcode-tip">æ‰«æäºŒç»´ç æ·»åŠ å•†å®¶å¾®ä¿¡</text>
        </view>
      </view>
      <!-- ç”µè¯å·ç  -->
      <view class="contact-method">
        <text class="method-title">ç”µè¯è”ç³»</text>
        <view class="phone-container">
          <text class="phone-number">{{merchantInfo.phone}}</text>
          <button class="call-btn" bindtap="callMerchant">
            <text class="call-icon">ğŸ“</text>
            <text>æ‹¨æ‰“</text>
          </button>
        </view>
      </view>
    </view>
  </view>
</view>