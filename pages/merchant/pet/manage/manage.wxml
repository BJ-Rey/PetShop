<!-- pages/merchant/pet/manage/manage.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">è¿”å›</text>
    <text class="page-title">å® ç‰©ç®¡ç†</text>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <input 
      class="search-input" 
      placeholder="æœç´¢å® ç‰©åç§°ã€å“ç§æˆ–å¹´é¾„" 
      bindinput="onSearch"
      value="{{filter.keyword}}"
    />
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-row">
      <!-- çŠ¶æ€ç­›é€‰ -->
      <view class="filter-item">
        <view class="filter-header" bindtap="toggleFilter" data-type="status">
          <text class="filter-label">çŠ¶æ€ï¼š</text>
          <text class="filter-value">{{filter.status === 'all' ? 'å…¨éƒ¨' : filter.status === 'published' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}</text>
          <text class="filter-arrow {{expandedFilter === 'status' ? 'up' : 'down'}}">â–¼</text>
        </view>
        <view class="filter-options" wx:if="{{expandedFilter === 'status'}}">
          <view 
            class="filter-option {{filter.status === 'all' ? 'active' : ''}}" 
            data-type="status" 
            data-value="all"
            bindtap="changeFilter"
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-option {{filter.status === 'published' ? 'active' : ''}}" 
            data-type="status" 
            data-value="published"
            bindtap="changeFilter"
          >
            å·²ä¸Šæ¶
          </view>
          <view 
            class="filter-option {{filter.status === 'unpublished' ? 'active' : ''}}" 
            data-type="status" 
            data-value="unpublished"
            bindtap="changeFilter"
          >
            å·²ä¸‹æ¶
          </view>
        </view>
      </view>
      
      <!-- å“ç±»ç­›é€‰ -->
      <view class="filter-item">
        <view class="filter-header" bindtap="toggleFilter" data-type="category">
          <text class="filter-label">å“ç±»ï¼š</text>
          <text class="filter-value">{{filter.category === 'all' ? 'å…¨éƒ¨' : filter.category === 'ç‹—' ? 'ç‹—' : filter.category === 'çŒ«' ? 'çŒ«' : 'å…¶ä»–'}}</text>
          <text class="filter-arrow {{expandedFilter === 'category' ? 'up' : 'down'}}">â–¼</text>
        </view>
        <view class="filter-options" wx:if="{{expandedFilter === 'category'}}">
          <view 
            class="filter-option {{filter.category === 'all' ? 'active' : ''}}" 
            data-type="category" 
            data-value="all"
            bindtap="changeFilter"
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-option {{filter.category === 'ç‹—' ? 'active' : ''}}" 
            data-type="category" 
            data-value="ç‹—"
            bindtap="changeFilter"
          >
            ç‹—
          </view>
          <view 
            class="filter-option {{filter.category === 'çŒ«' ? 'active' : ''}}" 
            data-type="category" 
            data-value="çŒ«"
            bindtap="changeFilter"
          >
            çŒ«
          </view>
        </view>
      </view>
      
      <!-- æ˜¯å¦æœ‰äººä¸‹å®šç­›é€‰ -->
      <view class="filter-item">
        <view class="filter-header" bindtap="toggleFilter" data-type="isOrdered">
          <text class="filter-label">ä¸‹å®šçŠ¶æ€ï¼š</text>
          <text class="filter-value">{{filter.isOrdered === 'all' ? 'å…¨éƒ¨' : filter.isOrdered === 'yes' ? 'å·²ä¸‹å®š' : 'æœªä¸‹å®š'}}</text>
          <text class="filter-arrow {{expandedFilter === 'isOrdered' ? 'up' : 'down'}}">â–¼</text>
        </view>
        <view class="filter-options" wx:if="{{expandedFilter === 'isOrdered'}}">
          <view 
            class="filter-option {{filter.isOrdered === 'all' ? 'active' : ''}}" 
            data-type="isOrdered" 
            data-value="all"
            bindtap="changeFilter"
          >
            å…¨éƒ¨
          </view>
          <view 
            class="filter-option {{filter.isOrdered === 'yes' ? 'active' : ''}}" 
            data-type="isOrdered" 
            data-value="yes"
            bindtap="changeFilter"
          >
            å·²ä¸‹å®š
          </view>
          <view 
            class="filter-option {{filter.isOrdered === 'no' ? 'active' : ''}}" 
            data-type="isOrdered" 
            data-value="no"
            bindtap="changeFilter"
          >
            æœªä¸‹å®š
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ’åºæ  -->
  <view class="sort-bar">
    <view 
      class="sort-item {{sortField === 'createdAt' ? 'active' : ''}}" 
      data-field="createdAt"
      bindtap="changeSort"
    >
      <text>åˆ›å»ºæ—¶é—´</text>
      <text class="sort-icon">{{sortField === 'createdAt' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
    </view>
    <view 
      class="sort-item {{sortField === 'sales' ? 'active' : ''}}" 
      data-field="sales"
      bindtap="changeSort"
    >
      <text>é”€é‡</text>
      <text class="sort-icon">{{sortField === 'sales' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
    </view>
    <view 
      class="sort-item {{sortField === 'price' ? 'active' : ''}}" 
      data-field="price"
      bindtap="changeSort"
    >
      <text>ä»·æ ¼</text>
      <text class="sort-icon">{{sortField === 'price' ? (sortOrder === 'desc' ? 'â†“' : 'â†‘') : ''}}</text>
    </view>
  </view>

  <!-- æ·»åŠ å® ç‰©æŒ‰é’® -->
  <view class="add-pet-section">
    <button class="add-btn" type="primary" bindtap="addPet">+ æ·» åŠ </button>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-action-bar" wx:if="{{pets.length > 0}}">
    <view class="batch-select">
      <checkbox-group bindchange="toggleAllSelect">
        <label class="checkbox-label">
          <checkbox value="all" checked="{{isAllSelected}}" />
          <text>å…¨é€‰</text>
        </label>
      </checkbox-group>
      <text class="selected-count" wx:if="{{selectedPetIds.length > 0}}">({{selectedPetIds.length}} é¡¹)</text>
    </view>
    <view class="batch-buttons">
      <!-- åŸºç¡€æ‰¹é‡æ“ä½œæŒ‰é’® -->
      <button class="batch-btn" bindtap="batchPublish" wx:if="{{selectedPetIds.length > 0}}">æ‰¹é‡ä¸Šæ¶</button>
      <button class="batch-btn" bindtap="batchUnpublish" wx:if="{{selectedPetIds.length > 0}}">æ‰¹é‡ä¸‹æ¶</button>
      <button class="batch-btn delete" bindtap="batchDelete" wx:if="{{selectedPetIds.length > 0}}">æ‰¹é‡åˆ é™¤</button>
    </view>
  </view>

  <!-- å® ç‰©åˆ—è¡¨ -->
  <view class="product-list">
    <view class="empty-state" wx:if="{{!isLoading && pets.length === 0}}">
      <text class="empty-icon">ğŸ±</text>
      <text class="empty-text">æš‚æ— çŒ«å’ªæ•°æ®</text>
      <button class="empty-btn" type="primary" bindtap="addPet">æ·»åŠ çŒ«å’ª</button>
    </view>
    
    <view class="loading-state" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <block wx:else>
      <view class="product-item card" wx:for="{{pets}}" wx:key="id">
        <checkbox-group bindchange="toggleSelect" data-id="{{item.id}}">
          <label class="checkbox-label">
            <checkbox value="{{item.id}}" checked="{{selectedPetIds.indexOf(item.id) > -1}}" />
          </label>
        </checkbox-group>
        <image class="product-image" src="{{item.avatar}}"></image>
        
        <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <text class="product-category">{{item.category === 'çŒ«' ? 'çŒ«' : 'å…¶ä»–'}}</text>
            
            <view class="product-price">
              <text class="current-price">Â¥{{item.price}}</text>
              <text class="deposit-info">ï¼ˆå®šé‡‘ï¼šÂ¥{{item.deposit}}ï¼‰</text>
            </view>
            
            <view class="product-meta">
              <text class="product-stock">{{item.breed}} â€¢ {{item.age}} â€¢ {{item.gender === 'male' ? 'å…¬' : 'æ¯'}}</text>
              <text class="product-sales">é”€é‡ï¼š{{item.sales}}</text>
            </view>
          </view>
        
        <view class="product-status">
          <text class="status-tag {{item.status === 'published' ? 'published' : 'unpublished'}}">
            {{item.status === 'published' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}
          </text>
          <text class="status-tag {{item.isOrdered ? 'ordered' : 'not-ordered'}}">
            {{item.isOrdered ? 'å·²ä¸‹å®š' : 'æœªä¸‹å®š'}}
          </text>
        </view>
        
        <view class="product-actions">
          <button 
            class="action-btn view-btn" 
            bindtap="viewPetDetail" 
            data-id="{{item.id}}"
          >
            è¯¦æƒ…
          </button>
          <button 
            class="action-btn edit-btn" 
            bindtap="editPet" 
            data-id="{{item.id}}"
          >
            ç¼–è¾‘
          </button>
          <button 
            class="action-btn {{item.status === 'published' ? 'unpublish-btn' : 'publish-btn'}}" 
            bindtap="togglePetStatus" 
            data-id="{{item.id}}"
          >
            {{item.status === 'published' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}
          </button>
          <button 
            class="action-btn delete-btn" 
            bindtap="deletePet" 
            data-id="{{item.id}}" 
            data-name="{{item.name}}"
          >
            åˆ é™¤
          </button>
        </view>
      </view>
    </block>
  </view>
</view>