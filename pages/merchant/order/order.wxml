<!-- pages/merchant/order/order.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">â†</text>
    <text class="page-title">è®¢å•å¤„ç†</text>
    <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <input 
      class="search-input" 
      placeholder="æœç´¢è®¢å•ç¼–å·æˆ–å®¢æˆ·åç§°" 
      bindinput="onSearch"
      value="{{keyword}}"
    />
  </view>

  <!-- è®¢å•çŠ¶æ€ç­›é€‰ -->
  <view class="status-tabs">
    <scroll-view scroll-x="true" class="tabs-scroll" enable-flex>
      <view 
        class="tab-item {{activeTab === 'all' ? 'active' : ''}}" 
        data-tab="all"
        bindtap="switchTab"
      >
        å…¨éƒ¨è®¢å•
      </view>
      <view 
        class="tab-item {{activeTab === 'pending' ? 'active' : ''}}" 
        data-tab="pending"
        bindtap="switchTab"
      >
        å¾…ä»˜æ¬¾
      </view>
      <view 
        class="tab-item {{activeTab === 'processing' ? 'active' : ''}}" 
        data-tab="processing"
        bindtap="switchTab"
      >
        å¾…å‘è´§
      </view>
      <view 
        class="tab-item {{activeTab === 'shipped' ? 'active' : ''}}" 
        data-tab="shipped"
        bindtap="switchTab"
      >
        å¾…æ”¶è´§
      </view>
      <view 
        class="tab-item {{activeTab === 'completed' ? 'active' : ''}}" 
        data-tab="completed"
        bindtap="switchTab"
      >
        å·²å®Œæˆ
      </view>
      <view 
        class="tab-item {{activeTab === 'cancelled' ? 'active' : ''}}" 
        data-tab="cancelled"
        bindtap="switchTab"
      >
        å·²å–æ¶ˆ
      </view>
    </scroll-view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <view class="empty-state" wx:if="{{!isLoading && filteredOrders.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•æ•°æ®</text>
    </view>
    
    <view class="loading-state" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <block wx:else>
      <view class="order-item card" wx:for="{{filteredOrders}}" wx:key="id">
        <!-- è®¢å•å¤´éƒ¨ä¿¡æ¯ -->
        <view class="order-header">
          <text class="order-number">è®¢å•å·ï¼š{{item.orderNumber}}</text>
          <text class="order-status {{item.status}}">
            {{item.status === 'pending' ? 'å¾…ä»˜æ¬¾' : item.status === 'processing' ? 'å¾…å‘è´§' : item.status === 'shipped' ? 'å¾…æ”¶è´§' : item.status === 'completed' ? 'å·²å®Œæˆ' : item.status === 'cancelled' ? 'å·²å–æ¶ˆ' : 'æœªçŸ¥çŠ¶æ€'}}
          </text>
        </view>
        
        <!-- å®¢æˆ·ä¿¡æ¯ -->
        <view class="customer-info">
          <text class="customer-name">å®¢æˆ·ï¼š{{item.customer.name}}</text>
          <text class="customer-phone">{{item.customer.phone}}</text>
          <text class="customer-address">{{item.customer.address}}</text>
        </view>
        
        <!-- è®¢å•å•†å“åˆ—è¡¨ -->
        <view class="order-products">
          <view class="product-item" wx:for="{{item.products}}" wx:key="id" wx:for-item="product">
            <image class="product-image" src="{{product.image}}"></image>
            <view class="product-info">
              <text class="product-name">{{product.name}}</text>
              <text class="product-spec">è§„æ ¼ï¼š{{product.spec}}</text>
            </view>
            <view class="product-quantity">x{{product.quantity}}</view>
            <view class="product-price">Â¥{{product.price}}</view>
          </view>
        </view>
        
        <!-- è®¢å•é‡‘é¢ä¿¡æ¯ -->
        <view class="order-amount">
          <view class="amount-item">
            <text class="label">å•†å“æ€»é¢ï¼š</text>
            <text class="value">Â¥{{item.subtotal}}</text>
          </view>
          <view class="amount-item">
            <text class="label">è¿è´¹ï¼š</text>
            <text class="value">Â¥{{item.shippingFee}}</text>
          </view>
          <view class="amount-item total">
            <text class="label">è®¢å•æ€»é¢ï¼š</text>
            <text class="value">Â¥{{item.total}}</text>
          </view>
        </view>
        
        <!-- è¿å•å·ä¿¡æ¯ -->
        <view class="tracking-info" wx:if="{{item.status === 'shipped' || item.status === 'completed'}}">
          <text class="tracking-label">è¿å•å·ï¼š</text>
          <block wx:if="{{item.trackingNumber}}">
            <text class="tracking-number">{{item.trackingNumber}}</text>
            <button class="copy-btn" bindtap="copyTrackingNumber" data-number="{{item.trackingNumber}}">å¤åˆ¶</button>
          </block>
          <block wx:else>
            <view class="tracking-input-container">
              <input 
                class="tracking-input" 
                placeholder="è¯·è¾“å…¥è¿å•å·" 
                bindinput="onTrackingInput" 
                data-id="{{item.id}}"
              />
              <button class="save-btn" bindtap="saveTrackingNumber" data-id="{{item.id}}">ä¿å­˜</button>
            </view>
          </block>
        </view>
        
        <!-- è®¢å•æ“ä½œæŒ‰é’® -->
        <view class="order-actions">
          <button 
            class="action-btn view-btn" 
            bindtap="viewOrderDetail" 
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
          
          <!-- æ ¹æ®è®¢å•çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„æ“ä½œæŒ‰é’® -->
          <button 
            class="action-btn primary-btn" 
            bindtap="confirmPayment" 
            data-id="{{item.id}}"
            wx:if="{{item.status === 'pending'}}"
          >
            ç¡®è®¤ä»˜æ¬¾
          </button>
          
          <button 
            class="action-btn primary-btn" 
            bindtap="shipOrder" 
            data-id="{{item.id}}"
            wx:if="{{item.status === 'processing'}}"
          >
            å‘è´§
          </button>
          
          <button 
            class="action-btn primary-btn" 
            bindtap="confirmDelivery" 
            data-id="{{item.id}}"
            wx:if="{{item.status === 'shipped'}}"
          >
            ç¡®è®¤æ”¶è´§
          </button>
          
          <button 
            class="action-btn primary-btn" 
            bindtap="refundOrder" 
            data-id="{{item.id}}"
            wx:if="{{item.status === 'completed'}}"
          >
            é€€æ¬¾
          </button>
          
          <button 
            class="action-btn delete-btn" 
            bindtap="cancelOrder" 
            data-id="{{item.id}}"
            wx:if="{{item.status === 'pending' || item.status === 'processing'}}"
          >
            å–æ¶ˆè®¢å•
          </button>
        </view>
      </view>
    </block>
  </view>
</view>