<!-- pages/merchant/setting/permission/permission.wxml -->
<wxs module="utils">
  module.exports.getPermissionName = function(permissionCode) {
    var map = {
      'manage_pets': 'å® ç‰©ç®¡ç†',
      'manage_products': 'å•†å“ç®¡ç†',
      'manage_orders': 'è®¢å•ç®¡ç†',
      'manage_finance': 'è´¢åŠ¡ç®¡ç†',
      'manage_settings': 'ç³»ç»Ÿè®¾ç½®',
      'view_reports': 'æŸ¥çœ‹æŠ¥è¡¨'
    };
    return map[permissionCode] || permissionCode;
  }
</wxs>

<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">â†</text>
    <text class="page-title">è§’è‰²ä¸æƒé™ç®¡ç†</text>
    <button class="logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
  </view>

  <!-- æ“ä½œæ  -->
  <view class="operation-bar">
    <button class="add-btn" type="primary" bindtap="addRole">æ·»åŠ è§’è‰²</button>
  </view>

  <!-- è§’è‰²åˆ—è¡¨ -->
  <view class="role-list">
    <view class="empty-state" wx:if="{{!isLoading && roles.length === 0}}">
      <text class="empty-icon">ğŸ”‘</text>
      <text class="empty-text">æš‚æ— è§’è‰²æ•°æ®</text>
      <button class="empty-btn" type="primary" bindtap="addRole">æ·»åŠ è§’è‰²</button>
    </view>
    
    <view class="loading-state" wx:if="{{isLoading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
    
    <block wx:else>
      <view class="role-item card" wx:for="{{roles}}" wx:key="id">
        <view class="role-header">
          <view class="role-info">
            <text class="role-name">{{item.name}}</text>
            <text class="role-desc">{{item.description}}</text>
          </view>
          <view class="role-action">
            <button 
              class="action-btn edit-btn" 
              bindtap="editRole" 
              data-id="{{item.id}}"
            >
              ç¼–è¾‘
            </button>
            <button 
              class="action-btn delete-btn" 
              bindtap="deleteRole" 
              data-id="{{item.id}}" 
              data-name="{{item.name}}"
              wx:if="{{item.id !== 1}}"
            >
              åˆ é™¤
            </button>
          </view>
        </view>
        
        <view class="role-permissions">
          <text class="permission-title">æƒé™åˆ—è¡¨ï¼š</text>
          <view class="permission-tags">
            <text class="permission-tag" wx:for="{{item.permissions}}" wx:for-item="permission" wx:key="permission">
              {{utils.getPermissionName(permission)}}
            </text>
          </view>
        </view>
      </view>
    </block>
  </view>
</view>