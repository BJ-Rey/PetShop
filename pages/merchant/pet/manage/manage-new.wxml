<!-- pages/merchant/pet/manage/manage-new.wxml -->
<wxs module="utils">
  module.exports.formatDate = function(dateString) {
    if (!dateString) return '';
    var date = getDate(dateString);
    var year = date.getFullYear();
    var month = date.getMonth() + 1;
    var day = date.getDate();
    
    if (month < 10) month = '0' + month;
    if (day < 10) day = '0' + day;
    
    return year + '-' + month + '-' + day;
  }
</wxs>

<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="standard-action-bar">
    <text class="standard-back-btn" bindtap="navigateBack">â†</text>
    <text class="page-title">å® ç‰©ç®¡ç†</text>
  </view>

  <!-- ç­›é€‰ä¸æœç´¢åŒºåŸŸ -->
  <view class="filter-search-bar">
    <!-- æœç´¢æ¡† -->
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        type="text" 
        placeholder="æœç´¢å® ç‰©åç§°ã€å“ç§..." 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        class="search-input"
      />
      <text 
        class="clear-btn" 
        wx:if="{{searchKeyword}}"
        bindtap="clearSearch"
      >
        Ã—
      </text>
    </view>
    
    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="status-filter">
      <picker 
        mode="selector" 
        range="{{statusOptions}}" 
        range-key="name" 
        value="{{selectedStatusIndex}}" 
        bindchange="onStatusChange"
      >
        <view class="filter-picker">
          <text>çŠ¶æ€ï¼š{{statusOptions[selectedStatusIndex].name}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ’åºæ  -->
  <view class="sort-bar">
    <text class="sort-label">æ’åºï¼š</text>
    <view class="sort-options">
      <view 
        class="sort-option {{sortField === 'sort' ? 'active' : ''}}" 
        bindtap="changeSortField" 
        data-field="sort"
      >
        <text>æ’åºä¼˜å…ˆçº§</text>
        <text class="sort-arrow {{sortField === 'sort' ? (sortOrder === 'asc' ? 'asc' : 'desc') : ''}}">
          {{sortField === 'sort' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : 'â†•'}}
        </text>
      </view>
      <view 
        class="sort-option {{sortField === 'createdAt' ? 'active' : ''}}" 
        bindtap="changeSortField" 
        data-field="createdAt"
      >
        <text>åˆ›å»ºæ—¶é—´</text>
        <text class="sort-arrow {{sortField === 'createdAt' ? (sortOrder === 'asc' ? 'asc' : 'desc') : ''}}">
          {{sortField === 'createdAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : 'â†•'}}
        </text>
      </view>
      <view 
        class="sort-option {{sortField === 'updatedAt' ? 'active' : ''}}" 
        bindtap="changeSortField" 
        data-field="updatedAt"
      >
        <text>æ›´æ–°æ—¶é—´</text>
        <text class="sort-arrow {{sortField === 'updatedAt' ? (sortOrder === 'asc' ? 'asc' : 'desc') : ''}}">
          {{sortField === 'updatedAt' ? (sortOrder === 'asc' ? 'â†‘' : 'â†“') : 'â†•'}}
        </text>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ å® ç‰©æŒ‰é’® -->
  <view class="add-pet-section">
    <button class="btn btn-primary" bindtap="navigateToAddPet">
      <text class="btn-icon">+</text>
      <text>æ·»åŠ å® ç‰©</text>
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:elif="{{pets.length === 0}}">
    <text class="empty-icon">ğŸ¶</text>
    <text class="empty-title">æš‚æ— å® ç‰©æ•°æ®</text>
    <text class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªå® ç‰©å§</text>
    <button class="btn btn-primary" bindtap="navigateToAddPet">
      <text class="btn-icon">+</text>
      <text>æ·»åŠ å® ç‰©</text>
    </button>
  </view>

  <!-- å® ç‰©åˆ—è¡¨ -->
  <view class="pet-list" wx:else>
    <view class="pet-card" wx:for="{{pets}}" wx:key="id">
      <!-- å® ç‰©åŸºæœ¬ä¿¡æ¯ -->
      <view class="pet-info">
        <image src="{{item.avatar}}" class="pet-avatar" mode="aspectFill"></image>
        <view class="pet-details">
          <view class="pet-header">
            <text class="pet-name">{{item.name}}</text>
            <view class="pet-status {{item.status}}">
              <text class="status-dot"></text>
              <text class="status-text">{{item.status === 'published' ? 'å·²ä¸Šæ¶' : 'å·²ä¸‹æ¶'}}</text>
            </view>
          </view>
          <text class="pet-meta">
            {{item.breed}} â€¢ {{item.age}} â€¢ {{item.gender === 'male' ? 'å…¬' : 'æ¯'}} â€¢ {{item.color}}
          </text>
          <view class="pet-price-info">
            <text class="price-item">ä»·æ ¼: Â¥{{item.price}}</text>
            <text class="deposit-item">å®šé‡‘: Â¥{{item.deposit}}</text>
          </view>
          <view class="pet-time-info">
            <text class="time-item">åˆ›å»º: {{utils.formatDate(item.createdAt)}}</text>
            <text class="time-item">æ›´æ–°: {{utils.formatDate(item.updatedAt)}}</text>
          </view>
        </view>
      </view>
      
      <!-- æ“ä½œåŒºåŸŸ -->
      <view class="pet-actions">
        <!-- æ’åºç¼–è¾‘ -->
        <view class="sort-edit-section">
          <text class="sort-label">æ’åº:</text>
          <view class="sort-input-wrapper">
            <input 
              type="number" 
              value="{{item.sort}}" 
              class="sort-input" 
              bindinput="onSortInput" 
              data-id="{{item.id}}"
              min="0"
              max="9999"
            />
            <text class="sort-hint">æ•°å­—è¶Šå¤§ï¼Œæ’åºè¶Šé å‰</text>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’®ç»„ -->
        <view class="action-buttons-group">
          <!-- ä¸Šä¸‹æ¶æŒ‰é’® -->
          <button 
            class="btn {{item.status === 'published' ? 'btn-warning' : 'btn-success'}} status-btn"
            bindtap="togglePetStatus"
            data-id="{{item.id}}"
            data-status="{{item.status}}"
          >
            {{item.status === 'published' ? 'ä¸‹æ¶' : 'ä¸Šæ¶'}}
          </button>
          
          <!-- ç¼–è¾‘æŒ‰é’® -->
          <button 
            class="btn btn-primary edit-btn"
            bindtap="navigateToEditPet"
            data-id="{{item.id}}"
          >
            ç¼–è¾‘
          </button>
          
          <!-- åˆ é™¤æŒ‰é’® -->
          <button 
            class="btn btn-danger delete-btn"
            bindtap="showDeleteConfirm"
            data-id="{{item.id}}"
            data-name="{{item.name}}"
          >
            åˆ é™¤
          </button>
          
          <!-- æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® -->
          <button 
            class="btn btn-default view-btn"
            bindtap="navigateToPetDetail"
            data-id="{{item.id}}"
          >
            è¯¦æƒ…
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showDeleteModal}}" bindtap="hideDeleteModal"></view>
  <view class="modal" wx:if="{{showDeleteModal}}">
    <view class="modal-header">
      <text class="modal-title">ç¡®è®¤åˆ é™¤</text>
      <text class="modal-close" bindtap="hideDeleteModal">Ã—</text>
    </view>
    <view class="modal-content">
      <text class="modal-message">ç¡®å®šè¦åˆ é™¤å® ç‰©ã€Œ{{deletePetName}}ã€å—ï¼Ÿ</text>
      <text class="modal-warning">æ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œåˆ é™¤åè¯¥å® ç‰©çš„æ‰€æœ‰ä¿¡æ¯å°†è¢«æ°¸ä¹…åˆ é™¤ã€‚</text>
    </view>
    <view class="modal-actions">
      <button class="btn btn-default" bindtap="hideDeleteModal">å–æ¶ˆ</button>
      <button class="btn btn-danger" bindtap="confirmDeletePet">åˆ é™¤</button>
    </view>
  </view>
</view>